<link rel="import" href="../bower_components/polymer/polymer.html" />
<dom-module id="admin-page">
    <link rel="import" href="../bower_components/iron-icons/iron-icons.html" />
    <link rel="import" href="../bower_components/iron-iconset/iron-iconset.html" />
    <link rel="import" href="../bower_components/paper-material/paper-material.html" />
    <link rel="import" href="../sweet-material-table.html" />
    <link rel="import" href="../sweet-material-table-item.html" />
    <link rel="import" href="sweet-material-numeric-table-item.html" />
    <link rel="import" href="sweet-material-percent-table-item.html" />
    <link rel="import" href="../sweet-material-table-styles.html" />
    <link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
    <link rel="import" href="bower_components/neon-animation/animations/scale-up-animation.html">
    <link rel="import" href="bower_components/neon-animation/animations/fade-out-animation.html">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <template>
        <style include="sweet-material-table-styles"></style>
        <style is="custom-style">
            /* sweet-material-table::shadow #table .th:not([data-column="name"]) {
         text-align: left;
         }*/
            
            input[type=checkbox] {
                display: none;
            }
            /* hide the checkbox */
            
            label,
            p {
                padding-left: 50px;
            }
            
            #check-awesome {
                position: relative;
            }
            /* checkbox css ------------------------------------ */
            /* show a cursor when we hover */
            
            label {
                cursor: pointer;
            }
            /* style all of our span tags with position absolute and over to the left */
            
            label span {
                display: block;
                position: absolute;
                left: 0;
                transition-duration: 0.3s;
            }
            /* style our circle and position it */
            
            label .circle {
                background: #FFF;
                left: -30px;
                top: -30px;
                height: 80px;
                width: 80px;
                z-index: -1;
                border-radius: 50%;
            }
            
            label .circle1 {
                background: #FFF;
                left: -30px;
                top: -30px;
                height: 80px;
                width: 80px;
                z-index: -1;
                border-radius: 50%;
            }
            /* style our box */
            
            label .box {
                position: inherit;
                border: 2px solid #7B7676;
                height: 10px;
                width: 10px;
                z-index: 888;
                transition-delay: 0.2s;
                margin-top: -34px;
            }
            
            label .box1 {
                position: inherit;
                border: 2px solid #7B7676;
                height: 10px;
                width: 10px;
                z-index: 888;
                transition-delay: 0.2s;
                margin-top: -19px;
            }
            /* style the check. give it a border on the bottom and right only and then rotate */
            
            label .check {
                top: -7px;
                left: 6px;
                width: 5px;
                height: 11px;
                border: 2px solid #0f9d58;
                border-top: none;
                border-left: none;
                opacity: 0;
                z-index: 888;
                transform: rotate(180deg);
                transition-delay: 0.3s;
                margin-top: 27px;
            }
            
            label .check1 {
                top: -7px;
                left: 6px;
                width: 5px;
                height: 11px;
                border: 2px solid #0f9d58;
                border-top: none;
                border-left: none;
                opacity: 0;
                z-index: 888;
                transform: rotate(180deg);
                transition-delay: 0.3s;
                margin-top: 15px;
            }
            
            input[type=checkbox]:checked ~ label .box {
                opacity: 0;
                transform: scale(0) rotate(-180deg);
            }
            /* rotate and show our check */
            
            input[type=checkbox]:checked ~ label .check {
                opacity: 1;
                transform: scale(1) rotate(45deg);
            }
            
            input[type=checkbox]:checked ~ label .box1 {
                opacity: 0;
                transform: scale(0) rotate(-180deg);
            }
            /* rotate and show our check */
            
            input[type=checkbox]:checked ~ label .check1 {
                opacity: 1;
                transform: scale(1) rotate(45deg);
            }
            
            label .circle {
                animation: growCircle 0.3s ease;
            }
            
            label .circle1 {
                animation: growCircle 0.3s ease;
            }
            
            @keyframes growCircle {
                0%,
                100% {
                    transform: scale(0);
                }
                70% {
                    background: #DDD;
                    transform: scale(1.25);
                }
            }
            
            #table .thead .tr .th {
                cursor: auto;
            }
            
            #table .thead .tr .th:not([data-column="name"]) {
                text-align: left;
                font-weight: bold;
                color: #C62828;
            }
            
            #table .tbody .tr .td:last-child iron-icon {
                text-align: right;
                color: #C62828;
                width: 53px;
                height: 20px;
                margin-top: 0px;
            }
            
            .small {
                --iron-icon-width: 19px;
                --iron-icon-height: 19px;
                margin-top: -98px;
                margin-left: 20px;
            }
            
            .small:hover {
                cursor: pointer;
                color: red;
            }
            
            .small1:hover {
                cursor: pointer;
                color: #0229F5;
            }
            
            .small1 {
                --iron-icon-width: 19px;
                --iron-icon-height: 19px;
                margin-top: -102px;
            }
            
            .small2 {
                --iron-icon-width: 19px;
                --iron-icon-height: 19px;
                margin-top: -52px;
                margin-left: -23px;
            }
            
            .paper-icon {
                margin-left: -36px;
                margin-top: -16px;
            }
            
            .check {
                margin-top: -35px;
            }
            
            .dialog {
                width: 70%;
            }
        </style>
        <script type="text/javascript">
            // per css-tricks restarting css animations
            // http://css-tricks.com/restart-css-animation/
            $("#check-me").click(function() {
                alert('Inside check-me');
                // find the first span which is our circle/bubble
                var el = $(this).children('.circle');

                // clone it
                var newone = el.clone(true);

                // add the cloned version before our original
                el.before(newone);

                // remove the original so that it is ready to run on next click
                $("." + el.attr("class") + ":last").remove();


            });
            $("#1").click(function() {
                alert('Inside check-me1');
                // find the first span which is our circle/bubble
                var el = $(this).children('.circle1');

                // clone it
                var newone = el.clone(true);

                // add the cloned version before our original
                el.before(newone);

                // remove the original so that it is ready to run on next click
                $("." + el.attr("class") + ":last").remove();
            });
        </script>
        <script type="text/javascript"></script>
        <paper-dialog id="actions" class="dialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
            <h2>Edit User details</h2>
            <paper-input name="name" value="{{name}}" label="name"> </paper-input>
            <paper-input name="email" value="{{email}}" label="email"> </paper-input>
            <paper-input name="phone" value="{{phone}}" label="phone"> </paper-input>
            <div class="buttons">
                <paper-button dialog-dismiss>Decline</paper-button>
                <paper-button dialog-confirm autofocus on-click="updateHandle">Accept</paper-button>
            </div>
        </paper-dialog>
        <paper-material>

            <sweet-material-table id="table" title="Admin Page" schema="{{schema}}" data="{{data}}" start="{{start}}" columns="{{columns}}" per-page="{{perPage}}" selectedIndexes="{{indexSelect}}" total="{{total}}" custom-thead-content=".thead" custom-tbody-content=".tbody" global-actions="{{globalActions}}">

                <div class="thead">
                    <div class="tr horizontal layout">
                        <div class="th checkbox">
                            <main class="container">
                                <div id="check-awesome" class="form-group">
                                    <input type="checkbox" id="check-me">
                                    <label for="check-me">
                                        <span class="circle"></span>
                                        <span class="check"></span>
                                        <span class="box"></span>
                                    </label>

                                </div>
                            </main>
                            <!--  <paper-checkbox id="selectAll" on-click="_selectAll"></paper-checkbox> -->
                        </div>
                        <template is="dom-repeat" items="{{columns}}" as="column">
                            <div class="th flex" data-column$="{{column.key}}">
                                <span>{{column.title}}</span>
                            </div>
                        </template>
                        <div class="th">Actions</div>
                    </div>
                </div>
                <div class="tbody">
                    <template is="dom-repeat" items="{{data}}" as="instance">
                        <div class="tr horizontal layout" index="[[index]]">
                            <div class="td checkbox">
                                <paper-icon-button icon="icons:more-vert" class="paper-icon"></paper-icon-button>
                                <!-- <paper-icon-button icon= "icons:more-vert" class="paper-icon"></paper-icon-button> -->

                                <div class="check">
                                    <div id="check-awesome" class="form-group">
                                        <input type="checkbox" ariaActiveAttribute="checkChange" id$="{{index}}">
                                        <label for$="{{index}}">
                                            <span class="circle1"></span>
                                            <span class="check1"></span>
                                            <span class="box1"></span>
                                        </label>
                                    </div>
                                </div>

                                <!--   <paper-checkbox on-click="_selectRow" index="{{index}}"></paper-checkbox> -->
                                <iron-icon icon="icons:star-border" class="small" on-click="changeStar"></iron-icon>
                                <iron-icon icon="icons:label-outline" class="small1"></iron-icon>

                            </div>

                            <template is="dom-repeat" items="{{columns}}" as="column">
                                <div class="flex td">
                                    <!--  <template is="dom-if" if="[[_isNumericColumn(column)]]">
                              <sweet-material-numeric-table-item class="flex"
                                                                 field="[[column]]"
                                                                 data-column$="[[column.key]]"
                                                                 row="{{instance}}"></sweet-material-numeric-table-item>
                              </template>
                              <template is="dom-if" if="[[_isPercentColumn(column)]]">
                              <sweet-material-percent-table-item class="flex"
                                                                 field="[[column]]"
                                                                 data-column$="[[column.key]]"
                                                                 row="{{instance}}"></sweet-material-percent-table-item>
                              </template> -->
                                    <template is="dom-if" if="[[_isStringColumn(column)]]">
                                        <sweet-material-table-item class="flex" field="{{column}}" data-column$="{{column.key}}" row="{{instance}}"></sweet-material-table-item>
                                    </template>
                                </div>
                            </template>
                            <div class="td">
                                <paper-button data-dialog="actions" on-click="clickHandler" data-args="{{index}}" style="padding:0"> edit</paper-button>
                                <iron-icon icon="icons:delete" on-click="del" data-args="{{index}}">
                                </iron-icon>
                            </div>
                        </div>
                    </template>
                </div>
            </sweet-material-table>
        </paper-material>
        </iron-ajax>
        <iron-ajax id="delReq" method="delete" content-type="application/json" url="/deleteUser" handle-as="json" on-response="delResponce">
        </iron-ajax>
        <iron-ajax id="updateRequest" method="put" content-type="application/json" url="/updateUser" handle-as="json" on-response="updateUserRes">
        </iron-ajax>
    </template>
    <script>
        Polymer({
            is: 'admin-page',
            ready: function() {

                this.schema = {
                    title: 'Nutrition',
                    properties: {

                        name: {
                            type: 'string',
                            title: 'Name'
                        },
                        phone: {
                            type: 'number',
                            title: 'Phone'
                        },
                        email: {
                            type: 'string',
                            title: 'Email'
                        },
                        _id: {
                            type: 'string',
                            title: 'Id'
                        },

                    }
                };

                this.perPage = 10;
                this.start = 0;
                this.total = 100;
                this.globalActions = [{
                    name: 'new',
                    icon: 'icons:new',
                    title: 'New record'
                }, {
                    name: 'deleteSelected',
                    iron: 'icons:delete',
                    title: 'Delete Selected',
                    /* Cloud to butt extension is magical */
                    action: 'deleteSelected',
                }];
            },
            properties: {
                data: {
                    type: Array,
                },
                none: {
                    type: String,
                    value: 'none',
                },
                indexSelect: {
                    type: Array,
                },
                lastName: {
                    type: String,
                },
                lastEmail: {
                    type: String,
                },
                lastPhone: {
                    type: Number,
                },
                lastIndex: {
                    type: Number,
                },
                lastId: {
                    type: Number,
                },

            },
            _selectRow: function(e) {
                alert(arguments[0].currentTarget.index);
                return this.$.table._selectRow.apply(this.$.table, arguments);
            },
            _isNumericColumn: function(column) {
                return [
                    'Phone'
                ].indexOf(column.key) !== -1;
            },
            _isPercentColumn: function(column) {
                return [

                ].indexOf(column.key) !== -1;
            },
            _isStringColumn: function(column) {
                return !this._isNumericColumn(column) && !this._isPercentColumn(column);
            },
            del: function(event) {

                var delIndex = arguments[0].currentTarget.dataArgs;

                var id = this.data[delIndex]._id;

                this.$.delReq.body = {
                    "id": id
                };
                this.$.delReq.generateRequest();
            },
            delResponce: function(response) {
                this.data = response.detail.response;
            },

            clickHandler: function(e) {
                var button = e.target;
                while (!button.hasAttribute('data-dialog') && button !== document.body) {
                    button = button.parentElement;
                }

                if (!button.hasAttribute('data-dialog')) {
                    return;
                }

                var id = button.getAttribute('data-dialog');
                var dialog = document.getElementById(id);
                if (dialog) {
                    dialog.open();

                    var delIndex = arguments[0].currentTarget.dataArgs;
                    this.lastIndex = delIndex;
                    this.name = this.data[delIndex].name;
                    this.lastName = this.data[delIndex].name;
                    this.phone = this.data[delIndex].phone;
                    this.lastPhone = this.data[delIndex].phone;
                    this.email = this.data[delIndex].email;
                    this.lastEmail = this.data[delIndex].email;
                    this.lastId = this.data[delIndex]._id;
                }
            },
            updateHandle: function() {
                if ((this.name !== this.lastName) ||
                    (this.email !== this.lastEmail) ||
                    (this.phone !== this.lastPhone)) {
                    this.data[this.lastIndex].name = this.name;
                    this.$.updateRequest.body = {
                        "id": this.lastId,
                        "name": this.name,
                        "phone": this.phone,
                        "email": this.email
                    };
                    this.$.updateRequest.generateRequest();
                }
            },
            updateUserRes: function(response) {
                this.data = response.detail.response;
            },
            checkChange: function(event) {
                alert('');
            },
            deleteSelected: function() {
                alert('deleteSelected');
            },
            changeStar: function() {
                if (this.none === 'none')
                    this.none = false;
                else
                    this.none = 'none';
            }
        });
        /*function del(index){
        alert(index);
        }*/
    </script>
</dom-module>
